REMOTE ADMINISTRATION WITH POWERSHELL (VERSION GITHUB â€“ FRANÃ‡AIS)

ğŸ‘‰ Formations PowerShell, Azure, M365 : https://itfit.tech

ğŸ‘‰ Automatisation & SÃ©curitÃ© : https://itfit.tech

# Administration Ã  distance avec PowerShell  
ğŸ‘‰ Formez-vous au PowerShell, Azure, M365 : https://itfit.tech  

---

# ğŸ§ª Exercice 1 : Activer le remoting PowerShell sur lâ€™ordinateur local

## ğŸ¯ TÃ¢che 1 : Activer le remoting

1. Connectez-vous Ã  **LAB-WS01** avec :  
   **itfit\Administrator**  

2. Ouvrir PowerShell en administrateur.

3. DÃ©finir la stratÃ©gie dâ€™exÃ©cution :

```powershell
Set-ExecutionPolicy RemoteSigned


Entrer Y pour valider.

Activer le remoting :

Enable-PSRemoting -SkipNetworkProfileCheck


Trouver une commande listant les configurations de session :

help *sessionconfiguration*


Lister les configurations existantes :

Get-PSSessionConfiguration

ğŸ§ª Exercice 2 : Remoting â€œone-to-oneâ€
ğŸ¯ TÃ¢che 1 : Se connecter Ã  un serveur distant & installer un rÃ´le

Ã‰tablir une session vers LAB-DC01 :

Enter-PSSession -ComputerName LAB-DC01


Installer le rÃ´le Network Load Balancing :

Install-WindowsFeature NLB


Quitter la session :

Exit-PSSession

ğŸ¯ TÃ¢che 2 : Tester le multi-hop (limitation par dÃ©faut)

Se connecter Ã  LAB-DC01 :

Enter-PSSession -ComputerName LAB-DC01


Depuis LAB-DC01, essayer de se connecter Ã  LAB-WS01 :

Enter-PSSession -ComputerName LAB-WS01


âš ï¸ Un message dâ€™erreur doit apparaÃ®tre (multi-hop non autorisÃ© par dÃ©faut).

Quitter :

Exit-PSSession

ğŸ¯ TÃ¢che 3 : Observer les limites du remoting

Connexion locale via remoting :

Enter-PSSession -ComputerName localhost


Essayer dâ€™exÃ©cuter une application graphique :

Notepad


âš ï¸ Notepad ne sâ€™affiche pas : les GUI ne sont pas transmises dans une session distante.

Interrompre avec Ctrl + C.

Quitter :

Exit-PSSession

ğŸ§ª Exercice 3 : Remoting â€œone-to-manyâ€
ğŸ¯ TÃ¢che 1 : Lister les cartes rÃ©seau physiques de plusieurs machines

Chercher une commande liÃ©e aux adaptateurs :

help *adapter*


Consulter lâ€™aide :

help Get-NetAdapter


Lancer la commande sur LAB-WS01 et LAB-DC01 :

Invoke-Command -ComputerName LAB-WS01,LAB-DC01 -ScriptBlock { Get-NetAdapter -Physical }

ğŸ¯ TÃ¢che 2 : Comparer sortie locale vs distante

Members dâ€™un process local :

Get-Process | Get-Member


Members dâ€™un process rÃ©cupÃ©rÃ© en remoting :

Invoke-Command -ComputerName LAB-DC01 -ScriptBlock { Get-Process } | Get-Member


âš ï¸ La sortie distante est dÃ©sÃ©rialisÃ©e, donc moins riche.

ğŸ§ª Exercice 4 : Implicit remoting
ğŸ¯ TÃ¢che 1 : CrÃ©er une connexion persistante

CrÃ©er une session persistante vers LAB-DC01 :

$dc = New-PSSession -ComputerName LAB-DC01


Afficher la session :

$dc

ğŸ¯ TÃ¢che 2 : Importer un module distant

Lister les modules disponibles sur LAB-DC01 :

Get-Module -ListAvailable -PSSession $dc


Chercher un module SMB :

Get-Module -ListAvailable -PSSession $dc | Where { $_.Name -like "*share*" }


Importer le module avec un prÃ©fixe :

Import-Module -PSSession $dc -Name SMBShare -Prefix DC


Afficher les partages de LAB-DC01 :

Get-DCSMBShare


Afficher les partages locaux :

Get-SMBShare

ğŸ¯ TÃ¢che 3 : Fermer toutes les sessions remoting
Get-PSSession | Remove-PSSession


VÃ©rifier que plus aucune session nâ€™est ouverte :

Get-PSSession

ğŸ§ª Exercice 5 : GÃ©rer plusieurs ordinateurs
ğŸ¯ TÃ¢che 1 : CrÃ©er plusieurs sessions simultanÃ©es

CrÃ©er des sessions vers LAB-WS01 et LAB-DC01 :

$computers = New-PSSession -ComputerName LAB-WS01,LAB-DC01


VÃ©rifier :

$computers

ğŸ¯ TÃ¢che 2 : Rapport des rÃ¨gles Firewall de deux machines

Trouver un module â€œsÃ©curitÃ©â€ :

Get-Module *security* -ListAvailable


Charger le module sur les deux machines :

Invoke-Command -Session $computers -ScriptBlock { Import-Module NetSecurity }


Lister les commandes du module :

Get-Command -Module NetSecurity


Afficher les rÃ¨gles Firewall activÃ©es :

Invoke-Command -Session $computers -ScriptBlock { Get-NetFirewallRule -Enabled True } |
Select Name,PSComputerName


DÃ©charger le module :

Invoke-Command -Session $computers -ScriptBlock { Remove-Module NetSecurity }

ğŸ¯ TÃ¢che 3 : Rapport HTML â€“ disques locaux

Localement :

Get-WmiObject -Class Win32_LogicalDisk -Filter "DriveType=3"


Ã€ distance (sur deux machines) :

Invoke-Command -Session $computers -ScriptBlock {
    Get-WmiObject -Class Win32_LogicalDisk -Filter "DriveType=3"
}


GÃ©nÃ©rer un rapport HTML :

Invoke-Command -Session $computers -ScriptBlock {
    Get-WmiObject -Class Win32_LogicalDisk -Filter "DriveType=3"
} | ConvertTo-Html -Property PSComputerName,DeviceID,FreeSpace,Size

ğŸ¯ TÃ¢che 4 : Fermer toutes les sessions
Get-PSSession | Remove-PSSession

ğŸ“˜ Ressources recommandÃ©es

â¡ Comprendre PowerShell & Remoting : https://itfit.tech

â¡ Formations administrateur moderne (Azure, M365, ADDS, Intune) : https://itfit.tech
