Principe

Liste des serveurs dans servers.txt

On teste avec Test-Connection

On log uniquement ceux qui répondent (ou tout, comme tu veux)
Toutes nos formations sur https://itfit.tech
Script : Ping-Servers.ps1

param(
    [Parameter(Mandatory = $true)]
    [string]$ServersListPath,      # ex: .\servers.txt

    [Parameter(Mandatory = $true)]
    [string]$LogPath               # ex: .\PingOK.log
)

if (Test-Path $LogPath) {
    Remove-Item $LogPath -Force
}

$servers = Get-Content -Path $ServersListPath

foreach ($server in $servers) {
    Write-Host "Ping $server..."

    $ping = Test-Connection -ComputerName $server -Count 1 -Quiet -ErrorAction SilentlyContinue

    if ($ping) {
        $line = "{0} - {1} répond au ping." -f (Get-Date), $server
        $line | Out-File -FilePath $LogPath -Append -Encoding UTF8
        Write-Host "  -> OK" -ForegroundColor Green
    } else {
        Write-Host "  -> KO" -ForegroundColor Red
    }
}
